<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>可视化平台</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="/static/offlinemap_ningbo/css/bmap.css"
    />
    <script
      type="text/javascript"
      src="/static/offlinemap_ningbo/map_load.js"
    ></script>
    <script
      type="text/javascript"
      src="/static/offlinemap_ningbo/bmapgl.min.js"
    ></script>
    <script src="/static/offlinemap_ningbo/mapv.min.js"></script>
    <script src="/static/offlinemap_ningbo/mapvgl.min.js"></script>
    <!-- <script type="text/javascript" src="offlinemap/tools/LuShu_min.js"></script>
    <script
      type="text/javascript"
      src="offlinemap/tools/TrackAnimation_min.js"
    ></script>
    <script
      type="text/javascript"
      src="offlinemap/tools/DistanceTool.min.js"
    ></script> -->
    <style type="text/css">
      html,
      body,
      #map_container {
        width: 100%;
        height: 100%;
        overflow: hidden;
        margin: 0;
      }

      .BMap_cpyCtrl {
        display: none;
      }

      .anchorBL {
        display: none;
      }

      /* .BMap_mask {
        z-index: 999;
      } */
      .visible-btn {
        position: absolute;
        z-index: 100;
        top: 6px;
        left: 6px;
        display: flex;
        flex-direction: column;
        padding: 6px;
        background-image: url("/static/images/visible.png");
        background-size: cover;
        width: 50px;
        height: 50px;
      }
      .panel :hover {
        padding: 8px;
      }
    </style>
  </head>
  <body>
    <div id="map_container"></div>
    <div class="panel">
      <div class="visible-btn" id="visibleBtn"></div>
    </div>
  </body>
  <script type="text/javascript">
    var map = new BMapGL.Map("map_container"); // 创建Map实例
    //初始化地图,设置中心点坐标和地图级别
    var nbu_center = [
      (121.6399780663538 + 121.64989824006494) / 2,
      (29.91130635333186 + 29.916690746146486) / 2,
    ];
    map.centerAndZoom(new BMapGL.Point(nbu_center[0], nbu_center[1]), 17);
    //开启鼠标滚轮缩放
    map.enableScrollWheelZoom(true);
    // map.disableDragging()

    var navi3DCtrl = new BMapGL.NavigationControl3D(); // 添加3D控件
    map.addControl(navi3DCtrl);
    var scaleCtrl = new BMapGL.ScaleControl(); // 添加比例尺控件
    map.addControl(scaleCtrl);

    var zoomCtrl = new BMapGL.ZoomControl(); // 添加缩放控件
    map.addControl(zoomCtrl);

    let style = [
      {
        featureType: "land",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          color: "#091220ff",
        },
      },
      {
        featureType: "water",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          color: "#113549ff",
        },
      },
      {
        featureType: "green",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          color: "#0e1b30ff",
        },
      },
      {
        featureType: "building",
        elementType: "geometry",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "building",
        elementType: "geometry.topfill",
        stylers: {
          color: "#113549ff",
        },
      },
      {
        featureType: "building",
        elementType: "geometry.sidefill",
        stylers: {
          color: "#143e56ff",
        },
      },
      {
        featureType: "building",
        elementType: "geometry.stroke",
        stylers: {
          color: "#dadada00",
        },
      },
      {
        featureType: "subwaystation",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          color: "#113549B2",
        },
      },
      {
        featureType: "education",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          color: "#12223dff",
        },
      },
      {
        featureType: "medical",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          color: "#12223dff",
        },
      },
      {
        featureType: "scenicspots",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          color: "#12223dff",
        },
      },
      {
        featureType: "highway",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          weight: "4",
        },
      },
      {
        featureType: "highway",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "highway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#fed66900",
        },
      },
      {
        featureType: "highway",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "highway",
        elementType: "labels.text.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "highway",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "highway",
        elementType: "labels.icon",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "arterial",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          weight: "2",
        },
      },
      {
        featureType: "arterial",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "arterial",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffeebb00",
        },
      },
      {
        featureType: "arterial",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "arterial",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "arterial",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "local",
        elementType: "geometry",
        stylers: {
          visibility: "on",
          weight: "1",
        },
      },
      {
        featureType: "local",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "local",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff66",
        },
      },
      {
        featureType: "local",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "local",
        elementType: "labels.text.fill",
        stylers: {
          color: "#979c9aff",
        },
      },
      {
        featureType: "local",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffffff",
        },
      },
      {
        featureType: "railway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "subway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          weight: "1",
        },
      },
      {
        featureType: "subway",
        elementType: "geometry.fill",
        stylers: {
          color: "#d8d8d8ff",
        },
      },
      {
        featureType: "subway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "subway",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "subway",
        elementType: "labels.text.fill",
        stylers: {
          color: "#979c9aff",
        },
      },
      {
        featureType: "subway",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffffff",
        },
      },
      {
        featureType: "continent",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "continent",
        elementType: "labels.icon",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "continent",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "continent",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "city",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "city",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "city",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "city",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "town",
        elementType: "labels.icon",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "town",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "town",
        elementType: "labels.text.fill",
        stylers: {
          color: "#454d50ff",
        },
      },
      {
        featureType: "town",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffffff",
        },
      },
      {
        featureType: "road",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "poilabel",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "districtlabel",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "road",
        elementType: "geometry",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "road",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "road",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "district",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "poilabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "poilabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "poilabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "manmade",
        elementType: "geometry",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "districtlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffffff",
        },
      },
      {
        featureType: "entertainment",
        elementType: "geometry",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "shopping",
        elementType: "geometry",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "nationalway",
        stylers: {
          level: "6",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        stylers: {
          level: "7",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        stylers: {
          level: "8",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        stylers: {
          level: "9",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        stylers: {
          level: "10",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "6",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "7",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "8",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "9",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "10",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "6",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "7",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "8",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "9",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "nationalway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "10",
          curZoomRegionId: "0",
          curZoomRegion: "6-10",
        },
      },
      {
        featureType: "cityhighway",
        stylers: {
          level: "6",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        stylers: {
          level: "7",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        stylers: {
          level: "8",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        stylers: {
          level: "9",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "6",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "7",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "8",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "geometry",
        stylers: {
          visibility: "off",
          level: "9",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "6",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "7",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "8",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "labels",
        stylers: {
          visibility: "off",
          level: "9",
          curZoomRegionId: "0",
          curZoomRegion: "6-9",
        },
      },
      {
        featureType: "subwaylabel",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "subwaylabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "tertiarywaysign",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "tertiarywaysign",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "provincialwaysign",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "provincialwaysign",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "nationalwaysign",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "nationalwaysign",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "highwaysign",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "highwaysign",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "village",
        elementType: "labels",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "district",
        elementType: "labels.text",
        stylers: {
          fontsize: "20",
        },
      },
      {
        featureType: "district",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "district",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "country",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "country",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "water",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "water",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "tertiaryway",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "tertiaryway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff10",
        },
      },
      {
        featureType: "provincialway",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "provincialway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "nationalway",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "nationalway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "highway",
        elementType: "labels.text",
        stylers: {
          fontsize: "20",
        },
      },
      {
        featureType: "nationalway",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "nationalway",
        elementType: "labels.text.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "nationalway",
        elementType: "labels.text",
        stylers: {
          fontsize: "20",
        },
      },
      {
        featureType: "provincialway",
        elementType: "labels.text.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "provincialway",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "provincialway",
        elementType: "labels.text",
        stylers: {
          fontsize: "20",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "labels.text.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "labels.text",
        stylers: {
          fontsize: "20",
        },
      },
      {
        featureType: "cityhighway",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "estate",
        elementType: "geometry",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "tertiaryway",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "tertiaryway",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "fourlevelway",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "fourlevelway",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "scenicspotsway",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "scenicspotsway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "universityway",
        elementType: "geometry.fill",
        stylers: {
          color: "#e9ecf1ff",
        },
      },
      {
        featureType: "universityway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "vacationway",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "vacationway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "fourlevelway",
        elementType: "geometry",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "fourlevelway",
        elementType: "geometry.fill",
        stylers: {
          color: "#12223dff",
        },
      },
      {
        featureType: "fourlevelway",
        elementType: "geometry.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "transportationlabel",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "transportationlabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "transportationlabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "transportationlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "educationlabel",
        elementType: "labels",
        stylers: {
          visibility: "on",
        },
      },
      {
        featureType: "educationlabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "educationlabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "educationlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "transportation",
        elementType: "geometry",
        stylers: {
          color: "#113549ff",
        },
      },
      {
        featureType: "airportlabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "airportlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "scenicspotslabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "scenicspotslabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "medicallabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "medicallabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "medicallabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "scenicspotslabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "airportlabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "entertainmentlabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "entertainmentlabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "entertainmentlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "estatelabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "estatelabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "estatelabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "businesstowerlabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "businesstowerlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "businesstowerlabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "companylabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "companylabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "companylabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "governmentlabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "governmentlabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "governmentlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "restaurantlabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "restaurantlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "restaurantlabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "hotellabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "hotellabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "hotellabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "shoppinglabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "shoppinglabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "shoppinglabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "lifeservicelabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "lifeservicelabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "lifeservicelabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "carservicelabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "carservicelabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "carservicelabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "financelabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "financelabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "financelabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "otherlabel",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "otherlabel",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "otherlabel",
        elementType: "labels.icon",
        stylers: {
          visibility: "off",
        },
      },
      {
        featureType: "manmade",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "manmade",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "transportation",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "transportation",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "education",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "education",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "medical",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "medical",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
      {
        featureType: "scenicspots",
        elementType: "labels.text.fill",
        stylers: {
          color: "#2dc4bbff",
        },
      },
      {
        featureType: "scenicspots",
        elementType: "labels.text.stroke",
        stylers: {
          color: "#ffffff00",
        },
      },
    ];
    map.setMapStyleV2({ styleJson: style });

    var bright = new mapvgl.BrightEffect({
      threshold: 0.2,
      blurSize: 2.0,
      clarity: 0.8,
    });
    var view = new mapvgl.View({
      effects: [bright],
      map: map,
    });

    // let lineLayer = new mapvgl.LineLayer({
    //   width: 5,
    //   lineCap: "round",
    //   color: "rgba(232, 92, 92, 1)",
    // });

    let lineLayer1 = new mapvgl.SimpleLineLayer({
      // blend: "lighter",
      // color: "rgba(232, 92, 92, 0.8)", // 飞线颜色
      color: "rgba(220, 220, 170,0.8)",
    });

    let lineLayer2 = new mapvgl.LineLayer({
      // blend: "lighter",
      color: "rgba(253, 56, 209, 0.9)", // 飞线颜色
      width: 2,
    });

    // 动画飞线效果
    // let flowLineLayer = new mapvgl.LineFlowLayer({
    //   color: "#fff",
    //   step: 3,
    // });
    //
    let flowLineLayer1 = new mapvgl.LineTripLayer({
      color: "rgb(255, 255, 204)", // 飞线动画颜色
      step: 0.3,
    });
    let flowLineLayer2 = new mapvgl.LineFlowLayer({
      color: "rgb(255, 255, 224)", // 飞线动画颜色
      duration: 4,
    });

    let textLayer = new mapvgl.TextLayer({
      collides: true,
      offset: [0, 20],
      color: "#fff",
      fontFamily: "PingFangSC-Medium",
    });
    let textLayerFlag = false;

    // var rippleLayer = new mapvgl.RippleLayer({
    //   color: "rgba(210, 72, 72, 0.5)",
    //   size: 10,
    // });
    view.addLayer(lineLayer1);
    view.addLayer(flowLineLayer1);
    view.addLayer(lineLayer2);
    view.addLayer(flowLineLayer2);
    // view.addLayer(rippleLayer);

    let visibleFlag = false;
    document.getElementById("visibleBtn").onclick = () => {
      visibleFlag = !visibleFlag;
      if (visibleFlag) view.addLayer(textLayer);
      else view.removeLayer(textLayer);
    };

    function updateTrackToMap(track) {
      let size = track.length;
      textLayer.clear();
      lineLayer1.clear();
      flowLineLayer1.clear();
      // lineLayer2.clear();
      // flowLineLayer2.clear();
      // rippleLayer.clear();
      let pointData = [];
      let lineData = [];
      let textData = [];
      if (track.length != 0) {
        map.centerAndZoom(
          new BMapGL.Point(
            track[0][0].start.loc_longitude,
            track[0][0].start.loc_latitude
          ),
          17
        );
        // track.forEach((item) => {
        //   pointData.push({
        //     geometry: {
        //       type: "Point",
        //       coordinates: [item.loc_longitude, item.loc_latitude],
        //     },
        //     properties: {
        //       record_time: item.record_time,
        //       loc_name: item.loc_name,
        //       text: `${item.record_time} ${item.loc_name}`,
        //     },
        //   });
        // });

        track.forEach((item) => {
          item.forEach((edge) => {
            let curve = new mapvgl.BezierCurve();
            let startPoint = map.lnglatToMercator(
              edge.start.loc_longitude,
              edge.start.loc_latitude
            );
            let endPoint = map.lnglatToMercator(
              edge.end.loc_longitude,
              edge.end.loc_latitude
            );
            pointData.push({
              geometry: {
                type: "Point",
                coordinates: [
                  edge.start.loc_longitude,
                  edge.start.loc_latitude,
                ],
              },
              properties: {
                loc_name: edge.start.loc_name,
                text: `${edge.start.loc_name}`,
              },
            });
            pointData.push({
              geometry: {
                type: "Point",
                coordinates: [edge.end.loc_longitude, edge.end.loc_latitude],
              },
              properties: {
                loc_name: edge.end.loc_name,
                text: `${edge.end.loc_name}`,
              },
            });
            curve.setOptions({
              start: [startPoint[0], startPoint[1]],
              end: [endPoint[0], endPoint[1]],
            });
            let curveModelData = curve.getPoints(60);
            lineData.push({
              geometry: {
                type: "LineString",
                coordinates: curveModelData,
              },
            });
          });
        });
        // rippleLayer.setData(pointData);
        textLayer.setData(pointData);
        // if (pointData.length > 1) {
        //   let num = pointData.length;
        //   for (let i = 1; i < num; i++) {
        //     let curve = new mapvgl.BezierCurve();

        //     let startPoint = map.lnglatToMercator(
        //       pointData[i - 1].geometry.coordinates[0],
        //       pointData[i - 1].geometry.coordinates[1]
        //     );
        //     let endPoint = map.lnglatToMercator(
        //       pointData[i].geometry.coordinates[0],
        //       pointData[i].geometry.coordinates[1]
        //     );

        //     curve.setOptions({
        //       start: [startPoint[0], startPoint[1]],
        //       end: [endPoint[0], endPoint[1]],
        //     });
        // curve.setOptions({
        //   points: [
        //     pointData[i - 1].geometry.coordinates,
        //     pointData[i].geometry.coordinates,
        //   ],
        // });
        // let curveModelData = curve.getPoints(60);
        // lineData.push({
        //   geometry: {
        //     type: "LineString",
        //     coordinates: curveModelData,
        //   },
        // });
        lineLayer1.setData(lineData);

        flowLineLayer1.setData(
          lineData.map((item) => {
            item.geometry.coordinates = item.geometry.coordinates.map(
              (item) => {
                item[2] += 5;
                return item;
              }
            );
            return item;
          })
        );
      }
      // map.setHeading(64.5)
      map.setTilt(73)
    }

    function updatePersonTrackToMap(personTrack) {
      let size = personTrack.length;
      lineLayer2.clear();
      flowLineLayer2.clear();
      // rippleLayer.clear();
      // let pointData = [];
      let lineData2 = [];
      // let textData = [];
      if (personTrack.length != 0) {
        // track.forEach((item) => {
        //   pointData.push({
        //     geometry: {
        //       type: "Point",
        //       coordinates: [item.loc_longitude, item.loc_latitude],
        //     },
        //     properties: {
        //       record_time: item.record_time,
        //       loc_name: item.loc_name,
        //       text: `${item.record_time} ${item.loc_name}`,
        //     },
        //   });
        // });

        personTrack.forEach((edge) => {
          let curve = new mapvgl.BezierCurve();
          let startPoint = map.lnglatToMercator(
            edge.start.loc_longitude,
            edge.start.loc_latitude
          );
          let endPoint = map.lnglatToMercator(
            edge.end.loc_longitude,
            edge.end.loc_latitude
          );
          // pointData.push({
          //   geometry: {
          //     type: "Point",
          //     coordinates: [edge.start.loc_longitude, edge.start.loc_latitude],
          //   },
          //   properties: {
          //     loc_name: edge.start.loc_name,
          //     text: `${edge.start.loc_name}`,
          //   },
          // });
          // pointData.push({
          //   geometry: {
          //     type: "Point",
          //     coordinates: [edge.end.loc_longitude, edge.end.loc_latitude],
          //   },
          //   properties: {
          //     loc_name: edge.end.loc_name,
          //     text: `${edge.end.loc_name}`,
          //   },
          // });
          curve.setOptions({
            start: [startPoint[0], startPoint[1]],
            end: [endPoint[0], endPoint[1]],
          });
          let curveModelData = curve.getPoints(60);
          lineData2.push({
            geometry: {
              type: "LineString",
              coordinates: curveModelData,
            },
          });
        });

        // rippleLayer.setData(pointData);
        // textLayer.setData(pointData);
        // if (pointData.length > 1) {
        //   let num = pointData.length;
        //   for (let i = 1; i < num; i++) {
        //     let curve = new mapvgl.BezierCurve();

        //     let startPoint = map.lnglatToMercator(
        //       pointData[i - 1].geometry.coordinates[0],
        //       pointData[i - 1].geometry.coordinates[1]
        //     );
        //     let endPoint = map.lnglatToMercator(
        //       pointData[i].geometry.coordinates[0],
        //       pointData[i].geometry.coordinates[1]
        //     );

        //     curve.setOptions({
        //       start: [startPoint[0], startPoint[1]],
        //       end: [endPoint[0], endPoint[1]],
        //     });
        // curve.setOptions({
        //   points: [
        //     pointData[i - 1].geometry.coordinates,
        //     pointData[i].geometry.coordinates,
        //   ],
        // });
        // let curveModelData = curve.getPoints(60);
        // lineData.push({
        //   geometry: {
        //     type: "LineString",
        //     coordinates: curveModelData,
        //   },
        // });
        // lineLayer1.setData(lineData);

        // flowLineLayer1.setData(
        //   lineData.map((item) => {
        //     item.geometry.coordinates = item.geometry.coordinates.map(
        //       (item) => {
        //         item[2] += 2;
        //         return item;
        //       }
        //     );
        //     return item;
        //   })
        // );
        lineLayer2.setData(lineData2);
        flowLineLayer2.setData(
          lineData2.map((item) => {
            item.geometry.coordinates = item.geometry.coordinates.map(
              (item) => {
                item[2] += 2;
                return item;
              }
            );
            return item;
          })
        );
      }
      // map.setHeading(64.5)
      
      map.centerAndZoom(
        new BMapGL.Point(
          personTrack[0].start.loc_longitude,
          personTrack[0].start.loc_latitude
        ),
        17
        );
      map.setTilt(73)
    }

    //   }
    // }
    window.addEventListener("message", (e) => {
      if (e.data.event === "updateTrack") {
        let track = e.data.msg.track;
        if(track.length!=0)updateTrackToMap(track);
        // loadPointListToMap(track);
      }
    });
    window.addEventListener("message", (e) => {
      if (e.data.event === "updatePersonTrack") {
        let personTrack = e.data.msg.personTrack;
        updatePersonTrackToMap(personTrack);
        // loadPointListToMap(track);
      }
    });
  </script>
</html>